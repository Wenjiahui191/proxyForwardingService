# Koa è¯·æ±‚è½¬å‘æœåŠ¡

åŸºäºKoaçš„åç«¯è¯·æ±‚è½¬å‘æœåŠ¡ï¼Œå°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°èšåˆæ•°æ®è‚¡ç¥¨API (`http://web.juhe.cn/finance/stock`)ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ åŸºäºKoaæ¡†æ¶ï¼Œè½»é‡é«˜æ•ˆ
- ğŸ”„ æ”¯æŒæ‰€æœ‰HTTPæ–¹æ³•çš„è¯·æ±‚è½¬å‘
- ğŸ“¡ è‡ªåŠ¨è½¬å‘æŸ¥è¯¢å‚æ•°å’Œè¯·æ±‚ä½“
- ğŸ›¡ï¸ å†…ç½®é”™è¯¯å¤„ç†å’ŒCORSæ”¯æŒ
- ğŸ“Š è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—è®°å½•
- ğŸ“ æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿï¼ˆå¼€å‘ç¯å¢ƒæ§åˆ¶å°ï¼Œç”Ÿäº§ç¯å¢ƒæ–‡ä»¶ï¼‰
- ğŸ—‚ï¸ æŒ‰å¤©è½®è½¬çš„æ—¥å¿—æ–‡ä»¶ç®¡ç†
- ğŸ¥ å¥åº·æ£€æŸ¥æ¥å£

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¯åŠ¨æœåŠ¡

```bash
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

### ç”Ÿäº§æ¨¡å¼

```bash
npm run prod
```

## æ—¥å¿—ç³»ç»Ÿ

é¡¹ç›®é›†æˆäº†æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿï¼Œæ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©è¾“å‡ºæ–¹å¼ï¼š

### å¼€å‘ç¯å¢ƒ
- æ‰€æœ‰æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°
- æ”¯æŒå½©è‰²è¾“å‡ºä¾¿äºè°ƒè¯•
- å®æ—¶æŸ¥çœ‹è¯·æ±‚å’Œé”™è¯¯ä¿¡æ¯

### ç”Ÿäº§ç¯å¢ƒ
- æ—¥å¿—è‡ªåŠ¨å†™å…¥ `logs/` æ–‡ä»¶å¤¹
- æŒ‰å¤©è‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶
- åˆ†ç±»å­˜å‚¨ä¸åŒçº§åˆ«çš„æ—¥å¿—ï¼š
  - `app-YYYY-MM-DD.log` - åº”ç”¨æ—¥å¿—
  - `requests-YYYY-MM-DD.log` - è¯·æ±‚æ—¥å¿—
  - `error-YYYY-MM-DD.log` - é”™è¯¯æ—¥å¿—
  - `exceptions-YYYY-MM-DD.log` - å¼‚å¸¸æ—¥å¿—
  - `rejections-YYYY-MM-DD.log` - Promiseæ‹’ç»æ—¥å¿—

### æ—¥å¿—é…ç½®
- å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§20MB
- ä¿ç•™30å¤©çš„å†å²æ—¥å¿—
- è¯·æ±‚æ—¥å¿—æ–‡ä»¶æœ€å¤§50MBï¼ˆè¯·æ±‚é‡å¤§ï¼‰

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬è½¬å‘
å‰ç«¯è¯·æ±‚ `/hs` å°†è¢«è½¬å‘åˆ° `http://web.juhe.cn/finance/stock/hs`

```bash
# ç¤ºä¾‹è¯·æ±‚
curl http://localhost:3000/hs?key=your_api_key&gid=sh000001

# å°†è½¬å‘åˆ°
# http://web.juhe.cn/finance/stock/hs?key=your_api_key&gid=sh000001
```

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:3000/health
```

è¿”å›æœåŠ¡çŠ¶æ€ä¿¡æ¯ï¼š
```json
{
  "status": "ok",
  "message": "Koaè¯·æ±‚è½¬å‘æœåŠ¡æ­£å¸¸è¿è¡Œ",
  "timestamp": "2025-07-06T12:00:00.000Z",
  "target": "http://web.juhe.cn/finance/stock"
}
```

## APIè¯´æ˜

### è½¬å‘è§„åˆ™
- **è·¯å¾„è½¬å‘**: `/path` â†’ `http://web.juhe.cn/finance/stock/path`
- **æ–¹æ³•æ”¯æŒ**: GET, POST, PUT, DELETEç­‰æ‰€æœ‰HTTPæ–¹æ³•
- **å‚æ•°ä¿æŒ**: æŸ¥è¯¢å‚æ•°å’Œè¯·æ±‚ä½“å®Œæ•´è½¬å‘
- **å¤´éƒ¨è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤å¯èƒ½é€ æˆé—®é¢˜çš„è¯·æ±‚å¤´

### é”™è¯¯å¤„ç†
- ç›®æ ‡æœåŠ¡å™¨é”™è¯¯ä¼šåŸæ ·è¿”å›çŠ¶æ€ç å’Œå“åº”
- ç½‘ç»œé”™è¯¯è¿”å›500çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯
- æ‰€æœ‰é”™è¯¯éƒ½ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
- `PORT`: æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤3000ï¼‰
- `NODE_ENV`: è¿è¡Œç¯å¢ƒï¼ˆdevelopment | productionï¼‰

### ç¯å¢ƒé…ç½®æ–‡ä»¶
å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¤ºä¾‹é…ç½®ï¼š
```env
NODE_ENV=development
PORT=3000
```

### ç›®æ ‡æœåŠ¡å™¨
åœ¨ `index.js` ä¸­ä¿®æ”¹ `TARGET_BASE_URL` å¸¸é‡æ¥æ›´æ”¹è½¬å‘ç›®æ ‡ã€‚

```javascript
const TARGET_BASE_URL = 'http://web.juhe.cn/finance/stock';
```

## é¡¹ç›®ç»“æ„

```
nodeServerTransform/
â”œâ”€â”€ index.js              # ä¸»æœåŠ¡æ–‡ä»¶
â”œâ”€â”€ logger.js             # æ—¥å¿—é…ç½®æ¨¡å—
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â”œâ”€â”€ package-lock.json      # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .env.example          # ç¯å¢ƒé…ç½®ç¤ºä¾‹
â”œâ”€â”€ .gitignore            # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶å¤¹ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
â”‚   â”œâ”€â”€ app-YYYY-MM-DD.log
â”‚   â”œâ”€â”€ requests-YYYY-MM-DD.log
â”‚   â”œâ”€â”€ error-YYYY-MM-DD.log
â”‚   â”œâ”€â”€ exceptions-YYYY-MM-DD.log
â”‚   â””â”€â”€ rejections-YYYY-MM-DD.log
â””â”€â”€ .github/
    â””â”€â”€ copilot-instructions.md  # CopilotæŒ‡ä»¤
```

## ä¾èµ–è¯´æ˜

- **koa**: Webæ¡†æ¶
- **koa-router**: è·¯ç”±ä¸­é—´ä»¶
- **axios**: HTTPè¯·æ±‚åº“
- **koa-bodyparser**: è¯·æ±‚ä½“è§£æ
- **koa-cors**: CORSæ”¯æŒ
- **winston**: ä¸“ä¸šæ—¥å¿—åº“
- **winston-daily-rotate-file**: æ—¥å¿—æ–‡ä»¶æŒ‰å¤©è½®è½¬

## å¼€å‘è¯´æ˜

### æ—¥å¿—è¾“å‡º
**å¼€å‘ç¯å¢ƒ**ï¼ˆæ§åˆ¶å°è¾“å‡ºï¼‰ï¼š
```
2025-07-06 12:00:00 [INFO]: ğŸš€ Koaè¯·æ±‚è½¬å‘æœåŠ¡å¯åŠ¨æˆåŠŸ!
2025-07-06 12:00:01 [INFO]: 192.168.1.100 "GET /hs?key=xxx&gid=sh000001" 200 150ms "Mozilla/5.0..."
2025-07-06 12:00:02 [INFO]: è½¬å‘è¯·æ±‚: GET /hs?key=xxx&gid=sh000001 -> http://web.juhe.cn/finance/stock/hs
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼ˆæ–‡ä»¶è¾“å‡ºï¼‰ï¼š
- åº”ç”¨æ—¥å¿—è®°å½•åˆ° `logs/app-2025-07-06.log`
- è¯·æ±‚æ—¥å¿—è®°å½•åˆ° `logs/requests-2025-07-06.log`
- é”™è¯¯æ—¥å¿—è®°å½•åˆ° `logs/error-2025-07-06.log`

### é”™è¯¯æ—¥å¿—
```
2025-07-06 12:00:00 [ERROR]: è½¬å‘è¯·æ±‚å¤±è´¥: Request failed with status code 404
2025-07-06 12:00:01 [WARN]: ç›®æ ‡æœåŠ¡å™¨é”™è¯¯: 404 - Not Found
```

## è®¸å¯è¯

ISC
